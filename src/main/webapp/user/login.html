<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <script src="../js/vue.global.js"></script>
    <script src="../js/axios.min.js"></script>
    <script src="../js/jquery-3.0.0.js"></script>
    <script src="../js/sweetalert2.all.min.js"></script>
    <script src="../js/sha1.min.js"></script>
    <link rel="stylesheet" href="../css/picnic.css">
    <style>
        td {
            text-align: center;
            background: #fff;
        }

        input {
            width: 300px;
        }
        button {
            width: 300px;
        }
    </style>
    <title>登录</title>
</head>
<body style="width: 100%;">
<div id="header"></div>
<script>
    $("#header").load("../header.html")
</script>
<div class="flex center one demo" id="app">
    <div class="500" style="width: 500px;">
        <table>
            <tr>
                <td colspan="2">
                    登录
                </td>
            </tr>
            <tr>
                <td>
                    用户名:
                </td>
                <td>
                    <input type="text" placeholder="用户名" v-model="username">
                </td>
            </tr>
            <tr>
                <td>
                    密码:
                </td>
                <td>
                    <input type="password" placeholder="密码6-16位" v-model="upassword">
                </td>
            </tr>
            <tr>
                <td></td>
                <td>
                    <label>
                        <input type="checkbox" id="loginStatusSave">
                        <span class="checkable">保存登录状态,30天内无需再次登录</span>
                    </label>
                </td>
            </tr>
            <tr>
                <td></td>
                <td>
                    <button @click="login" style="width: 300px;">登录</button>
                </td>
            </tr>
            <tr>
                <td></td>
                <td>
                    <a href="/user/register.html">注册账号</a>
                </td>
            </tr>
        </table>
    </div>
</div>
<script>
    const {createApp} = Vue
    createApp({
            data() {
                return {
                    username: '',
                    upassword: ''
                }
            },
            methods: {
                login: function () {
                    var ifsave=0
                    if ($("#loginStatusSave").prop('checked')) {
                        ifsave=1
                    }
                    if(this.upassword.length!=40)
                    {
                        this.upassword = sha1(this.upassword)
                    }

                    axios({
                        method: "POST",
                        url: "/loginServlet",
                        data: "username=" + this.username+"&upassword="+this.upassword+"&ifsave="+ifsave
                    }).then(function (resp) {
                        var icontype = "error"
                        if (resp.data.msg == '登录成功') {
                            icontype = 'success'
                            setTimeout("window.location.href='/index'", 1000)
                        }
                        Swal.fire({
                            icon: icontype,
                            title: resp.data.msg,
                            showConfirmButton: false,
                            timer: 1500
                        })
                    })
                }
            }
        }
    ).mount('#app')
</script>
</body>
</html>